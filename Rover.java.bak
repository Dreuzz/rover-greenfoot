import greenfoot.*;  // (World, Actor, GreenfootImage, Greenfoot and MouseInfo)
public class Rover extends Actor
{
    private Display anzeige;

    public int  anzahlMarkenInFolge() {
        int zaehler = 0;
        while(!huegelVorhanden("vorne")) {
            if(markeVorhanden()) {
                zaehler++;
            }
            fahre();
        }
        return zaehler;
    }

    public void markenFolgeAblegen(int pAnzahlMarken) {
        for(int markeSetzen = 1; markeSetzen <= pAnzahlMarken; markeSetzen++) {
            setzeMarke();
            fahre();
        }
    }

    public void rechnen(int reihe1, int reihe2) {
        int zaehler = 0;

        for(int reihe1setzen = 1; reihe1setzen <= reihe1; reihe1setzen++ ) {
            setzeMarke();
            if(markeVorhanden()) {
                zaehler++;
            }
            fahre();
        }
        bisEndeUndZurückUndNächste();

        for(int reihe2setzen = 1; reihe2setzen <= reihe2; reihe2setzen++ ) {
            setzeMarke();
            if(markeVorhanden()) {
                zaehler++;
            }
            fahre();
        }
        bisEndeUndZurückUndNächste();

        for(int reihe3setzen = 1; reihe3setzen <= zaehler; reihe3setzen++ ) {
            setzeMarke();
            fahre();
        }
        bisHuegelFahren();
    }

    public void bisHuegelFahren() {
        while(!huegelVorhanden("vorne")) {
            fahre();
        }
    }

    public void bisEndeUndZurückUndNächste() {
        bisHuegelFahren();
        drehe("rechts");
        drehe("rechts");
        bisHuegelFahren();
        drehe("links");
        fahre();
        drehe("links");
    }

    public void rechteck(int z, int h) {
        for(int k= 0; k < 2; k++) {
            for(int i = 1; i < z; i++) {
                setzeMarke();
                fahre();
            }
            drehe("rechts");
            for(int i = 1; i < h; i++) {
                setzeMarke();
                fahre();
            }
            drehe("rechts");
        }
    }

    public void lege(int x) {
        for(int k= 0; k < 4; k++) {
            for(int i = 1; i < x; i++) {
                setzeMarke();
                fahre();
            }
            drehe("rechts");
        }
    }

    public void s56nr2c() {
        int objektAnzahl = 0;

        while(!huegelVorhanden("vorne")) {
            while(gesteinVorhanden()) {
                nimmGestein();
                objektAnzahl++;
            }
            fahre();
        }
        if(objektAnzahl >= 3) {
            drehe("links");
            fahre();
        }
        else {
            drehe("rechts");
            fahre();
        }
    }

    public void s56nr2() {
        boolean vorhanden = false;
        while(!huegelVorhanden("vorne")) {
            if(gesteinVorhanden()) {
                vorhanden = true;
            }
            fahre();
        }
        if(vorhanden) {
            drehe("links");
        }
        else {
            drehe("rechts");
        }
        fahre();
    }

    public void ja4(int max) {
        for(int i = 1; i <= max; i++) {
            for(int s = 1; s<=2; s++) {
                for(int j = 1; j<=i; j++) {
                    setzeMarke();
                    fahre();

                }
                drehe("rechts");
            }
        }
    }

    public void ja3() {
        for(int m = 0; m<4; m++) {
            setzeMarke();
            fahre();
            fahre();
        }
        drehe("rechts");
        fahre();
        drehe("rechts");
        fahre();
        for(int n=0; n<4; n++) {
            setzeMarke();
            fahre();
            fahre();
        }
        drehe("rechts");
        fahre();
        drehe("rechts");
        fahre();
    }

    public void ja3_1test() {
        ja3_1();
        ja3_1();
    }

    public void ja3_1() {
        for(int m = 0; m<4; m++) {
            setzeMarke();
            fahre();
            fahre();
        }
        drehe("rechts");
        fahre();
        drehe("rechts");
        fahre();
        int m = 0;
    }

    public void ja2() {
        for(int i = 0; i<7; i++) {
            fahre();
        }
    }

    public void ja1() {
        while(!markeVorhanden()) {
            if(huegelVorhanden("links") && huegelVorhanden("rechts")) {
                nimmGestein();
                fahre();
            }else {
                fahre();
            }
        }
    }

    public void Schatzsuche() {
        while(!markeVorhanden()) {
            while(!huegelVorhanden("vorne")) {
                fahre();
            }
            if(gesteinVorhanden()){
                drehe("rechts");
            }else {
                drehe("links");
            }
        }
    }

    public void S44Nr3b() {
        ja();
        drehe("links");
        drehe("links");
        ja();
    }

    public void ja() {
        setzeMarke();
        fahre();
        while(!markeVorhanden()) {
            if(huegelVorhanden("links")) if(gesteinVorhanden()) {
                    nimmGestein();
                }
            fahre();
        }
    }

    public void A() {
        fahre();
        while(gesteinVorhanden()) {
            nimmGestein();
            fahre();
        }
        setzeMarke();
    }

    public void B() {
        do {
            fahre();
            nimmGestein();
        }while(gesteinVorhanden());
        setzeMarke();
    }

    public void C() {
        while(!huegelVorhanden("vorne")) {
            fahre();
            while(gesteinVorhanden()) {
                nimmGestein();
                fahre();
            }
        }
    }

    public void D() {
        while(!markeVorhanden()) {
            fahre();
            while(gesteinVorhanden()) {
                nimmGestein();
                fahre();
            }
            entferneMarke();
        }
    }

    public void pyramide() {
        while (!markeVorhanden()){
            if(!huegelVorhanden("vorne")){
                fahre();
            }
            else{
                drehe("links");
                fahre();
                drehe("rechts");
            }
        }
    }

    public void pyramide2() {
        fahreBisIchWill();
        mehrereStufen();
    }

    public void mehrereStufen() {
        while(huegelVorhanden("vorne")) {
            fahreStufe();
        }
    }

    public void fahreStufe() {
        drehe("links"); 
        while(huegelVorhanden("rechts")) {
            fahre();
        }
        drehe("rechts");
        fahre();
    }

    public void fahreBisIchWill() {
        while(!huegelVorhanden("vorne")) {
            fahre();
        }
    }

    /**
     * Der Rover bewegt sich ein Feld in Fahrtrichtung weiter.
     * Sollte sich in Fahrtrichtung ein Objekt der Klasse Huegel befinden oder er sich an der Grenze der Welt befinden,
     * dann erscheint eine entsprechende Meldung auf dem Display.
     */
    public void fahre()
    {
        int posX = getX();
        int posY = getY();

        if(huegelVorhanden("vorne"))
        {
            nachricht("Zu steil!");
        }
        // dafür sorgen, dass der Rover nicht in die unterste Zeile fährt...
        else if(getRotation()==90 && getY()==getWorld().getHeight()-2)
        {
            nachricht("Ich kann mich nicht bewegen");
        }
        else
        {
            move(1);
            Greenfoot.delay(1);
        }

        if(posX==getX()&&posY==getY()&&!huegelVorhanden("vorne"))
        {
            nachricht("Ich kann mich nicht bewegen");
        }
    }

    /**
     * Der Rover dreht sich um 90 Grad in die Richtung, die mit richtung („links“ oder „rechts“) übergeben wurde.
     * Sollte ein anderer Text (String) als "rechts" oder "links" übergeben werden, dann erscheint eine entsprechende Meldung auf dem Display.
     */
    public void drehe(String richtung)
    {
        if(richtung=="rechts")
        {
            setRotation(getRotation()+90);
        }
        else if (richtung=="links")
        {
            setRotation(getRotation()-90);
        }
        else
        {
            nachricht("Befehl nicht korrekt!");
        }
    }

    /**
     * Der Rover gibt durch einen Wahrheitswert (true oder false )zurück, ob sich auf seiner Position ein Objekt der Klasse Gestein befindet.
     * Eine entsprechende Meldung erscheint auch auf dem Display.
     */
    public boolean gesteinVorhanden()
    {
        if(getOneIntersectingObject(Gestein.class)!=null)
        {
            nachricht("Gestein gefunden!");
            return true;

        }

        return false;
    }

    /**
     * Der Rover überprüft, ob sich in richtung ("rechts", "links", oder "vorne") ein Objekt der Klasse Huegel befindet.
     * Das Ergebnis wird auf dem Display angezeigt.
     * Sollte ein anderer Text (String) als "rechts", "links" oder "vorne" übergeben werden, dann erscheint eine entsprechende Meldung auf dem Display.
     */
    public boolean huegelVorhanden(String richtung)
    {
        int rot = getRotation();

        if (richtung=="vorne" && rot==0 || richtung=="rechts" && rot==270 || richtung=="links" && rot==90)
        {
            if(getOneObjectAtOffset(1,0,Huegel.class)!=null && ((Huegel)getOneObjectAtOffset(1,0,Huegel.class)).getSteigung() >30)
            {
                return true;
            }
        }

        if (richtung=="vorne" && rot==180 || richtung=="rechts" && rot==90 || richtung=="links" && rot==270)
        {
            if(getOneObjectAtOffset(-1,0,Huegel.class)!=null && ((Huegel)getOneObjectAtOffset(-1,0,Huegel.class)).getSteigung() >30)
            {
                return true;
            }
        }

        if (richtung=="vorne" && rot==90 || richtung=="rechts" && rot==0 || richtung=="links" && rot==180)
        {
            if(getOneObjectAtOffset(0,1,Huegel.class)!=null && ((Huegel)getOneObjectAtOffset(0,1,Huegel.class)).getSteigung() >30)
            {
                return true;
            }

        }

        if (richtung=="vorne" && rot==270 || richtung=="rechts" && rot==180 || richtung=="links" && rot==0)
        {
            if(getOneObjectAtOffset(0,-1,Huegel.class)!=null && ((Huegel)getOneObjectAtOffset(0,-1,Huegel.class)).getSteigung() >30)
            {
                return true;
            }

        }

        if(richtung!="vorne" && richtung!="links" && richtung!="rechts")
        {
            nachricht("Befehl nicht korrekt!");
        }

        return false;
    }

    /**
     * Wenn an der Position des Rovers ein Gestein vorhanden ist, nimmt er es auf und gibt den Wassergehalt des
     * Gesteins aus.
     * Sollte kein Objekt der Klasse Gestein vorhanden sein, dann erscheint eine entsprechende Meldung auf dem Display.
     */
    public void nimmGestein()
    {
        if(gesteinVorhanden())
        {
            nachricht("Gestein untersucht! Wassergehalt ist " + ((Gestein)getOneIntersectingObject(Gestein.class)).getWassergehalt()+"%.");
            Greenfoot.delay(1);
            removeTouching(Gestein.class);
        }
        else 
        {
            nachricht("Hier ist kein Gestein");
        }
    }

    /**
     * Der Rover erzeugt ein Objekt der Klasse „Markierung“ auf seiner Position.
     */
    public void setzeMarke()
    {
        getWorld().addObject(new Marke(), getX(), getY());
    }

    /**
     * *Der Rover gibt durch einen Wahrheitswert (true oder false )zurück, ob sich auf seiner Position ein Objekt der Marke befindet.
     * Eine entsprechende Meldung erscheint auch auf dem Display.
     */
    public boolean markeVorhanden()
    {
        if(getOneIntersectingObject(Marke.class)!=null)
        {
            return true;
        }

        return false;
    }

    public void entferneMarke()
    {
        if(markeVorhanden())
        {
            removeTouching(Marke.class);
        }
    }

    public void nachricht(String pText)
    {

        if(anzeige!=null)
        {
            anzeige.anzeigen(pText);
            Greenfoot.delay(1);
            anzeige.loeschen();
        }
        else
        {
            System.out.println("Rover: \"" + pText + "\"");
        }
    }

    private void displayAusschalten()
    {
        getWorld().removeObject(anzeige);

    }

    protected void addedToWorld(World world)
    {

        setImage("images/rover.png");
        anzeige = new Display();
        world.addObject(anzeige, world.getWidth()/2, world.getHeight()-1);

        if(getY()==world.getHeight()-1)
        {
            setLocation(getX(),world.getHeight()-2);
        }
        anzeige.anzeigen("Ich bin bereit");
        this.nachricht("Ich bin bereit");

    }

}
